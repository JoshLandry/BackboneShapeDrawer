<!DOCTYPE html>
<html lang="en">
<html>
    <head>
        <meta charset="utf-8">
        <title>Rectangles</title>
        <script src="http://code.jquery.com/jquery-1.7.2.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/1.18.4/TweenMax.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/1.18.4/utils/Draggable.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/1.18.4/plugins/CSSPlugin.min.js"></script>
        <script src="./node_modules/underscore/underscore.js"></script>
        <script src="./node_modules/backbone/backbone.js"></script>
        <script src="./localStorage.js"></script>
        <style type="text/css">
            .rectangle {
                position: absolute;
                border: 4px solid black;
            }

            #canvas {
                height: 900px;
            }
        </style>
    </head>
    <body>
        <h1>Rectangles</h1>
        <div id="canvas"></div> <br>
        <button onclick="rectApp.add()">Add new Rectangle</button>
        <button onclick="rectApp.drawShapes()">Redraw Shapes</button>


        <div id="timer"></div>
        <div id="router"></div>
    </body>
    <script type="text/javascript">

        var documents = [
            new Backbone.Model({
                title: 'JavaScript Modules',
                content: 'why do we need modules'
            }),
            new Backbone.Model({
                title: 'content modules',
                content: 'why do we need content'
            })
        ];

        var eventAggregator = _.extend({}, Backbone.Events);

        var ContentsView = Backbone.View.extend({
            tagName: 'ul',
            render: function () {
                _(this.collection).each(function (document) {
                    this.$el.append(new DocumentListView({model: document}).render().el)
                }, this);
                return this;
            }
        });

        var DocumentListView = Backbone.View.extend({
            tagName: 'li',
            events: {
                'click': function(){
                    eventAggregator.trigger('document:selected', this.model);
                }
            },
            render: function () {
                this.$el.html(this.model.get('title'));
                return this;
            }
        });

        var DocumentView = Backbone.View.extend({
            render: function () {
                // this.$el.append(this.make('h1', null, this.model.get('title')));
                // this.$el.append(this.make('div', null, this.model.get('content')));
                $('#router').append("<h1>"+ this.model.get('title')+ "</h1>");
                $('#router').append(this.model.get('content'));
                return this;
            }
        });

        var DocumentRouter = Backbone.Router.extend({
            routes: {
                'contents': 'contents',
                'view/:title': 'viewDocument',
                'search/:query': 'search'
            },
            contents: function() {
                $('#router').html(new ContentsView({collection: documents}).render().el)
            },

            viewDocument: function (title) {
                var selectedDocument = _(documents).find(function (document) {
                    return document.get('title') === title;
                });

                $('#router').empty().append(new DocumentView({model: selectedDocument}).render().el);
            },
            search: function (query) {
                console.log('search for ' + query);
            }
        });

        eventAggregator.on('document:selected', function(document) {
            var urlPath = 'view/' + document.get('title');
            router.navigate(urlPath, {trigger:true});
        });

        var router = new DocumentRouter();
        Backbone.history.start();

        router.navigate('contents', {trigger:true});

    </script>
    <script type="text/javascript" src="rectangles.js"></script>
    <script type="text/javascript" src="timer.js"></script>
</html>